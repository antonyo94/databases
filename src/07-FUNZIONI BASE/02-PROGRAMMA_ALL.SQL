--FUNZIONE BASE 2
--Funzione che permette di programmare gli allenamenti nei prossimi 30 giorni,con cadenze settimanali stabilite dai 
--valori in input GIORNO1 e GIORNO2


CREATE OR REPLACE PROCEDURE PROGRAMMA_ALL(DATA_IN DATE,GIORNO1 CHAR,GIORNO2 CHAR,PATENTINO CHAR,CATEGORIA VARCHAR,ETA NUMBER,DURATA NUMBER) IS

I NUMBER:=0;
INSERISCI_ORA EXCEPTION;
GIORNO_CUR CHAR(10);
BEGIN
IF (TO_CHAR(DATA_IN,'DD-MM-YYYY HH24:MI:SS')  LIKE '%00:00:00') THEN 
RAISE INSERISCI_ORA;
END IF;

FOR I IN 0..30 LOOP
SELECT OTTIENI_GIORNO(DATA_IN+I) INTO GIORNO_CUR
FROM DUAL;
IF GIORNO_CUR=GIORNO1 OR GIORNO_CUR=GIORNO2 THEN
	INSERT INTO ALLENAMENTO VALUES(DATA_IN+I,PATENTINO,CATEGORIA,ETA,DURATA);
END IF;
END LOOP;

EXCEPTION
WHEN INSERISCI_ORA THEN RAISE_APPLICATION_ERROR(-20123,'Inserisci anche a che ora programmare gli allenamenti');
COMMIT;
END;