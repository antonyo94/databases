--FUNZIONE DI BASE 5
--Pocedura che permette di mostrare a video tutti i pagamenti effettuati da un allievo
CREATE OR REPLACE PROCEDURE INFO_PAGAMENTI(NUM_TESSERA CHAR) IS
CURSOR POINT IS
SELECT NOME_A,COGNOME_A,DATA_P,IMPORTO_P
FROM ALLIEVO A,PAGAMENTO P
WHERE A.N_TESSERINO=NUM_TESSERA AND A.N_TESSERINO=P.N_TESSERINO_PAGAMENTO;
CUR_VAR POINT%ROWTYPE;

BEGIN 
OPEN POINT;
LOOP 
FETCH POINT INTO CUR_VAR;
EXIT WHEN POINT%NOTFOUND;
DBMS_OUTPUT.PUT_LINE(CUR_VAR.NOME_A || ' ' || CUR_VAR.COGNOME_A || ' ' || CUR_VAR.DATA_P || ' ' || CUR_VAR.IMPORTO_P);

END LOOP;
CLOSE POINT;

EXCEPTION
WHEN NO_DATA_FOUND THEN RAISE_APPLICATION_ERROR(-20301,'Tale allievo non ha effettuato alcun pagamento');
END;
