--TRIGGER 2
--Controllare che il pagamento effettuato da un allievo sia ricevuto dal presedente o da un dirigente del settore amministrativo.

CREATE OR REPLACE TRIGGER CORRETTO_PAGAMENTO 
BEFORE INSERT ON PAGAMENTO
FOR EACH ROW
DECLARE
RUOLO_R DIRIGENTE.RUOLO%TYPE;
SETTORE_R DIRIGENTE.SETTORE%TYPE;
NON_POSSIBILE EXCEPTION;

BEGIN
SELECT RUOLO,SETTORE INTO RUOLO_R,SETTORE_R
FROM DIRIGENTE D
WHERE D.CF_D=:NEW.CF_D_PAGAMENTO;
IF RUOLO_R<>'PRESIDENTE' AND SETTORE_R<>'AMMINISTRATIVO' THEN
	RAISE NON_POSSIBILE;
END IF;

EXCEPTION
WHEN NON_POSSIBILE THEN
	RAISE_APPLICATION_ERROR(-20300,'Il dirigente non ricopre la carica per ricevere il pagamento');
END; 