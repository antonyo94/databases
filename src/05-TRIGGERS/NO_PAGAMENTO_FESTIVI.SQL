--TRIGGER 4
--Vincolo dinamico che non permette di effettuare pagamenti nei giorni festivi

CREATE OR REPLACE TRIGGER NO_PAGAMENTO_FESTIVI
BEFORE INSERT ON PAGAMENTO
FOR EACH ROW

DECLARE
GIORNO CHAR(10);
FESTIVO EXCEPTION;

BEGIN
SELECT OTTIENI_GIORNO(:NEW.DATA_P) INTO GIORNO
FROM DUAL;
IF GIORNO='SABATO' OR GIORNO='DOMENICA' THEN 
RAISE FESTIVO;
END IF;

EXCEPTION 
WHEN FESTIVO THEN RAISE_APPLICATION_ERROR(-20500,'Non possono esserci pagamenti di ' ||LOWER(GIORNO));
END;