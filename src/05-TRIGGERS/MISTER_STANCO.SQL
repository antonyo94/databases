--TRIGGER 7 
--Si cerca di tutelare il lavoro dei mister controllando che non eseguino piÃ¹ di 3 allenamenti settimanali

CREATE OR REPLACE TRIGGER MISTER_STANCO
BEFORE INSERT ON ALLENAMENTO
FOR EACH ROW

DECLARE
NUM_ALLENAMENTI NUMBER;
TROPPO_LAVORO EXCEPTION;

BEGIN 
SELECT COUNT(DATA_ALL) INTO NUM_ALLENAMENTI
FROM ALLENAMENTO
WHERE N_PATENTINO_ALLENAMENTO=:NEW.N_PATENTINO_ALLENAMENTO AND
		DATA_ALL BETWEEN :NEW.DATA_ALL-7 AND :NEW.DATA_ALL;
IF NUM_ALLENAMENTI > 3 THEN
RAISE TROPPO_LAVORO;
END IF;

EXCEPTION
WHEN TROPPO_LAVORO THEN
	RAISE_APPLICATION_ERROR(-20021,'Troppo lavoro per il mister questa settimana');
END;