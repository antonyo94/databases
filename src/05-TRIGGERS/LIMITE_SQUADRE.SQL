--TRIGGER 9
--Si impone un limite al lavoro di ogni mister facendo in modo che egli possa gestire un massimo numero di squadre pari a 3
CREATE OR REPLACE TRIGGER LIMITE_SQUADRE
BEFORE INSERT OR UPDATE OF N_PATENTINO_SQUADRA ON SQUADRA
FOR EACH ROW

DECLARE
NUM_SQUADRE NUMBER;
TROPPE_SQUADRE_MISTER EXCEPTION;

BEGIN 
SELECT COUNT(N_PATENTINO_SQUADRA) INTO NUM_SQUADRE
FROM SQUADRA
WHERE N_PATENTINO_SQUADRA = :NEW.N_PATENTINO_SQUADRA
GROUP BY N_PATENTINO_SQUADRA;
IF NUM_SQUADRE > 3 THEN
RAISE TROPPE_SQUADRE_MISTER;
END IF;

EXCEPTION 
WHEN TROPPE_SQUADRE_MISTER THEN RAISE_APPLICATION_ERROR(-20990,'Questo mister allena gia 3 squadre!!');
END;