--TRIGGER 6
--Per quanto consono ai bambini si controlla che non vi siano due allenamenti successivi,ovvero tra due allenamenti passino almeno 36 ore.
CREATE OR REPLACE TRIGGER GIORNI_SUCCESSIVI
BEFORE INSERT ON ALLENAMENTO
FOR EACH ROW
DECLARE
ULTIMO_ALLENAMENTO ALLENAMENTO.DATA_ALL%TYPE;
NON_DUE_GIORNI EXCEPTION;

BEGIN 
SELECT MAX(DATA_ALL) INTO ULTIMO_ALLENAMENTO
FROM ALLENAMENTO
WHERE CATEGORIA_S_ALLENAMENTO = :NEW.CATEGORIA_S_ALLENAMENTO AND ETA_S_ALLENAMENTO= :NEW.ETA_S_ALLENAMENTO AND DATA_ALL<:NEW.DATA_ALL;

IF  (:NEW.DATA_ALL-ULTIMO_ALLENAMENTO)*24 < 36 THEN
	RAISE NON_DUE_GIORNI;
END IF;

EXCEPTION
WHEN NON_DUE_GIORNI THEN 
RAISE_APPLICATION_ERROR(-20020,'La stessa categoria non deve allenarsi due giorni successivi');
END;